# Talos Upgrade Configuration
# Node profiles and cluster topology for talos-upgrade tool

settings:
  factory_base_url: "https://factory.talos.dev"
  default_timeout_seconds: 600
  default_preserve: true
  github_releases_url: "https://api.github.com/repos/siderolabs/talos/releases/latest"

# Node profiles define the hardware configurations
profiles:
  amd64-intel:
    description: "Intel GPU nodes with secureboot"
    arch: amd64
    platform: metal
    secureboot: true
    kernel_args:
      - pci=realloc
    extensions:
      - siderolabs/gasket-driver
      - siderolabs/i915
      - siderolabs/iscsi-tools
      - siderolabs/nut-client
      - siderolabs/realtek-firmware
      - siderolabs/thunderbolt
      - siderolabs/util-linux-tools
      - siderolabs/xe

  amd64-hybrid:
    description: "AMD+Intel hybrid node with secureboot"
    arch: amd64
    platform: metal
    secureboot: true
    kernel_args:
      - amd_iommu=off
    extensions:
      - siderolabs/amd-ucode
      - siderolabs/amdgpu
      - siderolabs/gasket-driver
      - siderolabs/i915
      - siderolabs/intel-ucode
      - siderolabs/iscsi-tools
      - siderolabs/nut-client
      - siderolabs/realtek-firmware
      - siderolabs/thunderbolt
      - siderolabs/util-linux-tools
      - siderolabs/xe

  arm64-rpi:
    description: "Raspberry Pi workers"
    arch: arm64
    platform: metal
    secureboot: false
    overlay:
      name: rpi_generic
      image: siderolabs/sbc-raspberrypi
    extensions:
      - siderolabs/iscsi-tools
      - siderolabs/util-linux-tools

  arm64-turing:
    description: "Turing RK1 control planes"
    arch: arm64
    platform: metal
    secureboot: false
    overlay:
      name: turingrk1
      image: siderolabs/sbc-rockchip
    extensions:
      - siderolabs/iscsi-tools
      - siderolabs/util-linux-tools

# Detection rules for automatic profile matching
# Nodes are discovered via Talos cluster members API
# Profiles are detected based on hardware info
detection:
  rules:
    - profile: arm64-rpi
      match:
        system_manufacturer: raspberrypi

    - profile: arm64-turing
      match:
        system_manufacturer: turing

    - profile: amd64-hybrid
      match:
        processor_manufacturer: "Advanced Micro Devices"

    - profile: amd64-intel
      match:
        processor_manufacturer: Intel
